# 愛爾達收視率分析 - 完整工作流程指南

## 📋 核心程式檔案

### 1. 資料提取階段
- **`runAnalysis.py`** - 從原始Excel節目表提取節目資料
- **原始檔案**: `【愛爾達綜合台】2024年1~12月節目表.xlsx`
- **輸出**: `program_schedule_extracted.csv`

### 2. 資料整合階段  
- **`integrateData.py`** - 整合節目表與收視率資料
- **輸入**: `program_schedule_extracted.csv` + `2024年綜合台中華電信會員V1分時收視資料.xlsx`
- **輸出**: `integrated_program_ratings.csv`

### 3. 資料清理階段
- **`clean_data.py`** - 清理劇集名稱，統一命名規則
- **輸入**: `integrated_program_ratings.csv`
- **輸出**: `integrated_program_ratings_cleaned.csv`

### 4. 分析與視覺化階段
- **`drama_analysis.py`** - 詳細收視率分析報告
- **`create_charts_heiti.py`** - 生成視覺化圖表（推薦，字體問題已解決）
- **`create_charts_english.py`** - 英文版圖表（備選）
- **輸出**: `ratings_analysis_heiti.png` 等圖表檔案

---

## 🚀 完整執行流程

### 方法1: 從頭開始（完整流程）

```bash
# 第1步：從原始Excel提取節目表
python runAnalysis.py

# 第2步：整合節目表與收視率資料
python integrateData.py

# 第3步：清理劇集名稱
python clean_data.py

# 第4步：執行分析
python drama_analysis.py

# 第5步：生成圖表
python create_charts_heiti.py
```

### 方法2: 快速執行（使用已清理資料）

```bash
# 直接執行分析（使用已清理的資料）
python drama_analysis.py

# 生成圖表
python create_charts_heiti.py
```

### 方法3: 一鍵完整執行

```bash
# 執行完整流程
python runAnalysis.py && python integrateData.py && python clean_data.py && python drama_analysis.py && python create_charts_heiti.py
```

---

## 📊 輸出檔案說明

### 中間產出檔案
- `program_schedule_extracted.csv` - 提取的節目表
- `integrated_program_ratings.csv` - 整合後的資料（未清理）
- `integrated_program_ratings_cleaned.csv` - 清理後的最終資料

### 最終產出檔案
- `ratings_analysis_heiti.png` - 主要圖表（推薦）
- `ratings_analysis_english.png` - 英文版圖表
- 終端輸出：詳細分析報告

---

## ✅ 資料品質控制

### 自動處理的問題
1. **日期年份錯誤** - 自動將2023年調整為2024年
2. **Excel日期格式** - 處理多種日期格式
3. **劇集命名不一致** - 自動統一劇集名稱
4. **時段對應** - 節目時間對應15分鐘收視時段
5. **中文字體顯示** - 使用黑體解決顯示問題

### 品質檢查指標
- 總記錄數：約10,000+筆
- 有收視率資料比例：>90%
- 主要劇集收視率範圍：0.1-0.9
- 時段覆蓋：8:00-22:00主要時段

---

## 🎯 主要分析結果

### 頂級劇集（預期結果）
1. 墨雨雲間 - 平均收視率 ~0.27
2. 延禧攻略 - 平均收視率 ~0.27  
3. 知否知否應是綠肥紅瘦 - 平均收視率 ~0.25

### 最佳時段
- **20點** - 黃金時段，平均收視率最高
- **19-21點** - 收視高峰時段
- **週末 vs 平日** - 差異分析

### 收視趨勢
- 月份收視率變化
- 劇集完結集效應
- 時段分布模式

---

## 🔧 疑難排解

### 常見問題
1. **檔案路徑錯誤** - 確認原始Excel檔案存在
2. **字體顯示問題** - 使用 `create_charts_heiti.py`
3. **記憶體不足** - 大檔案處理時可能需要更多記憶體
4. **編碼問題** - 所有輸出都使用 utf-8-sig 編碼

### 系統需求
- Python 3.7+
- pandas, matplotlib, seaborn, numpy
- 記憶體建議：4GB+
- 黑體字體（系統通常已安裝）

---

## 📈 使用建議

### 定期分析
```bash
# 每週更新分析（如有新資料）
python clean_data.py && python drama_analysis.py && python create_charts_heiti.py
```

### 自訂分析
```python
# 載入清理後資料進行自訂分析
import pandas as pd
df = pd.read_csv('integrated_program_ratings_cleaned.csv')
# 開始你的分析...
```

### 報告輸出
- 圖表：高解析度 PNG 格式
- 資料：CSV 格式，支援 Excel 開啟
- 分析：詳細文字報告

**推薦：使用 `create_charts_heiti.py` 獲得最佳視覺化效果！**
